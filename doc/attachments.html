<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Couchbeam - Manage attachments</title>
    <!--[if IE]>

    <script>
        // allow IE to recognize HTMl5 elements
        document.createElement('section');
        document.createElement('article');
        document.createElement('aside');
        document.createElement('footer');
        document.createElement('header');
        document.createElement('nav');
        document.createElement('time');

    </script>
    <![endif]-->
    <link rel="stylesheet" href="css/couchbeam.css?20091017" type="text/css" media="screen, projection" />
</head>
<body>
  <div id="container">
    
  <header id="mainhead">
    <h1><a href="index.html">Couchbeam 0.4.3</a></h1>
    <p id="download">get the source in <a href="http://github.com/benoitc/couchbeam">git</a> or <a href="http://bitbucket.org/benoitc/couchbeam">hg</a>, then <a href="http://github.com/benoitc/couchbeam/issues">send feedback</a></p>
    
  </header>
  
  <section id="content">
    <h1>Attachments</h1>
    
    <p>Here is a quick tutorial to show you how to handle attachments in couchbeam.</p>
    
    <h2>Basic</h2>
    
    <p>Attachments are managed with functions :</p>
      <ul>
        <li><code>couchbeam_db:fetch_attachment/3</code> to retrieve attachments</li> 
        <li><code>couchbeam_db:put_attachment/5 (or /6)</code> to send attachments</li>
        <li><code>couchbeam_db:delete_attachments/3</code> to delete attachments</li>
      </ul>
    <p>Here is a quick example that show you how to use these functions :</p>
    
    <script src="http://friendpaste.com/6slCFTUYBKmahgA3ZACvrF.js"></script>

    <h2>Stream attachments</h2>
    <p>With version 0.4.1 it's now possible to stream attachments. This is provided by the same functions as above <code>couchbeam_db:fetch_attachment/4</code> or <code>couchbeam_db:put_attachment/7</code>.</p>
    
    <h3>Upload an attachment</h3>
    <p>To stream upload, just provide a function arrity/0 or arity/1 to the content instead of an iolist. arity/0 return <code>{ok, Data}</code> each time it is called. To end upload it return the atom <code>eof</code>. arity/1 return <code>{ok, Data, NextState}</code> where <code>NextState</code> is the next state used by this function to continue.</p>
    <p>Following example show you how to upload a file with a size of 1MB as attachment to a doc:</p>
    
    <script src="http://friendpaste.com/5hAHrLaWx6KvGjwpO0oq01.js"></script>
    
    <h3>Get an attachment</h3>
    <p>To stream attachment fetching just provide the atom <code>true</code> as the end of the function <code>couchbeam_db:fetch_attachment/4</code>. The function will return you a pid. To fetch the attachment you have to use the function <code>couchbeam_resource:get_body_part/1</code>. This function return a state which is <code>{ok, Bin}</code> when a data arrives, <em>Bin</em> is a binary. When the attachment is arrived the function return <code>{ok, {http_eob, Trailers}}</code>, where you also get ending http trailers (you don't need them most of the time). Ex: </p>
    
    <script src="http://friendpaste.com/7A3jbhGWRjeCCNLtRem047.js"></script>
    
    <p>That's it for now. I hope this quick howto will help you.</p>
  </section>
  
  <footer>
    <p>2009-2010 &copy; <a href="http://benoitc.im">Beno√Æt Chesneau</a> - Some rights resenved</p>
  </footer>
  </div>
</body>